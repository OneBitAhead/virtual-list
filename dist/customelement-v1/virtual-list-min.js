"use strict";var _VirtualList_instances,_VirtualList_debounce,__classPrivateFieldGet=this&&this.__classPrivateFieldGet||function(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)};class VirtualList extends HTMLElement{constructor(){super(...arguments),_VirtualList_instances.add(this),this.visibleItems=0,this.lastRepaintY=0,this._items=[],this._itemheight=0}get items(){return this._items}get itemheight(){return this._itemheight||20}set items(t){null!=t&&(Array.isArray(t)||(t=[].concat(t)),this._items=t,this.onPropsChange(),this.render())}set itemheight(t){if(null==t)return;let e="number"==typeof t?Math.floor(t):parseInt(t,10);if(isNaN(e))throw new TypeError("Value has to be numeric");this._itemheight=e,this.setAttribute("itemheight",e.toString()),this.onPropsChange(),this.render()}connectedCallback(){this._items=[],this.lastRepaintY=0,this.visibleItems=0;const t=this.createContainer(),e=this.createScroller(this._itemheight*this._items.length);t.appendChild(e),this.container=t,this.template=this.getTemplate(),this.innerHTML="",this.style.display="inline-block",this.appendChild(t),this.visibleItems=Math.ceil(this.clientHeight/this._itemheight),this._onScroll=__classPrivateFieldGet(this,_VirtualList_instances,"m",_VirtualList_debounce).call(this,this.onScrollHandler.bind(this),50),this.container.addEventListener("scroll",this._onScroll)}disconnectCallback(){this.container.removeEventListener("scroll",this._onScroll)}static get observedAttributes(){return["itemheight"]}attributeChangedCallback(t,e,i){-1!==["itemheight"].indexOf(t)&&e!==i&&(this[t]=i)}createContainer(){const t=document.createElement("div");return Object.assign(t.style,{overflow:"auto",position:"relative",padding:0,height:"100%",width:"100%"}),t}createScroller(t){const e=document.createElement("div");return e.dataset.id="scroller",Object.assign(e.style,{opacity:0,position:"absolute",top:0,bottom:0,left:0,width:"1px",height:Math.floor(t)+"px"}),e}onPropsChange(){const t=((this._items||[]).length||0)*(this._itemheight||0);if(!this.container)return;const e=this.container.querySelector('[data-id="scroller"]');e&&(e.style.height=t+"px"),this.visibleItems=Math.ceil(this.clientHeight/this._itemheight)}onScrollHandler(t){window.requestAnimationFrame((()=>{if(t.target){var e=t.target.scrollTop;(!this.lastRepaintY||Math.abs(e-this.lastRepaintY)>Math.ceil(.8*this.clientHeight))&&(this.renderChunk(e),this.lastRepaintY=e),t.preventDefault&&t.preventDefault()}}))}getTemplate(t=!1){var e;if(e=this.hasAttribute("template")?document.querySelector(this.getAttribute("template")||""):this.querySelector("template"),!0===t)return e;if(e)return this.templateFactory(e.cloneNode(!0).innerHTML.trim());throw new Error("No template defined")}templateFactory(t){return new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+t.replace(/[\r\t\n]/g," ").split("{{").join("\t").replace(/((^|}})[^\t]*)'/g,"$1\r").replace(/\t(.*?)}}/g,"',$1,'").split("\t").join("');").split("}}").join("p.push('").split("\r").join("\\'")+"');}return p.join('');")}render(){this.container&&this.renderChunk(this.container.scrollTop||0)}renderChunk(t){let e=Math.max(Math.ceil(t/this._itemheight),0),i=Math.max(e-this.visibleItems,0);if(this.template&&this.container){const t={items:this._items.slice(i,i+3*this.visibleItems)};var s=document.createElement("div"),n="";if(this.template||(this.template=this.getTemplate()),t.items.forEach((t=>{let e=this.template(t);e&&(n+=e)})),s.innerHTML=n,s.children){let t=i;for(let e in s.children)s.children[e]instanceof HTMLElement&&(Object.assign(s.children[e].style,{height:this._itemheight+"px",position:"absolute",top:t*this._itemheight+"px",left:"0px",right:"0px"}),t++)}let e=this.container.querySelector('[data-id="scroller"]');s.appendChild(e),this.container.innerHTML=s.innerHTML}}}_VirtualList_instances=new WeakSet,_VirtualList_debounce=function(t,e,i=!1){var s;return function(){var n=globalThis,r=arguments,a=function(){s=null,i||t.apply(n,r)},h=i&&!s;s&&clearTimeout(s),s=setTimeout(a,e),h&&t.apply(n,r)}},window.customElements.define("virtual-list",VirtualList);